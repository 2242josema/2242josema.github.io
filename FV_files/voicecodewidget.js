ymxss=new function(){var WIDGET_TITLE="VoicePick Code Generator";var BASE_URL="http://voicecode.harvestmark.com/";var STYLESHEET=BASE_URL+"voicecode.css";var CONTENT_URL=BASE_URL+"contentpush.js";var ROOT="ym_voicecode_xss";function requestStylesheet(stylesheet_url){stylesheet=document.createElement("link");stylesheet.rel="stylesheet";stylesheet.type="text/css";stylesheet.href=stylesheet_url;stylesheet.media="all";document.lastChild.firstChild.appendChild(stylesheet)}function requestContent(local){var script=document.createElement("script");script.src=CONTENT_URL;document.getElementsByTagName("head")[0].appendChild(script)}this.init=function(){this.serverResponse=function(){var div=document.getElementById(ROOT);div.innerHTML="<fieldset class='yta_ww_vc_fieldset'><div class='yta_ww_vc_title'>"+WIDGET_TITLE+"</div><div class='yta_ww_vc_inputRow'><label for='gtin'>GTIN:</label><input id='vc_gtin' type='text' size='16' maxlength='14' onkeydown='ymxss.ResetGeneratedVoiceCode()' /></div><div class='yta_ww_vc_inputRow'><label for='lot'>Lot Code:</label><input id='vc_lot' type='text' size='16' maxlength='20' onkeydown='ymxss.ResetGeneratedVoiceCode()' /></div><div class='yta_ww_vc_inputRow'><label for='date'>Pack Date:</label><input id='vc_packDate' type='text' size='6' maxlength='6' onkeydown='ymxss.ResetGeneratedVoiceCode()' /><span class='yta_ww_vc_followdate'>YYMMDD<br/>(<span class='yta_ww_vc_italic'>Optional</span>)</span></div><div class='yta_ww_vc_codeRow'><input id='getVoiceCode' type='button' value='Generat Code' onclick='ymxss.DisplayVoiceCode()' /><span id='vc_generatedCode' class='yta_ww_vc_generatedCode'><span id='vc_minorCode' class='yta_ww_vc_minorCode'>00</span><span id='vc_majorCode' class='yta_ww_vc_majorCode'>00</span></span></div><div class='yta_ww_vc_creditsRow'>Copyright &copy; 2011 YottaMark, Inc. <br />Provider of the <a href='http://www.harvestmark.com'>HarvestMark&#174; solution</a></div></fieldset>";div.style.display="block";div.style.visibility="visible"};requestStylesheet(STYLESHEET);document.write("<div id='"+ROOT+"' style='display: none'></div>");requestContent();var no_script=document.getElementById("no_script");if(no_script){no_script.style.display="none"}};function NumericOnly(testString){for(i=0;i<testString.length;i++){testCharacter=testString.charAt(i);if((testCharacter<"0")||(testCharacter>"9")){return false}}return true}function InvalidGtin(gtin){if(gtin.length!=14){alert("A GTIN must be 14 digits long.");return true}for(i=0;i<gtin.length;i++){testCharacter=gtin.charAt(i);if(!NumericOnly(gtin)){alert("Only numbers 0-9 are allowed in a GTIN.");return true}}return false}function InvalidLot(lot){if(lot.length==0){alert("A lot code is required.");return true}if(lot.length>20){alert("A lot code cannot be longer than 20 characters.");return true}var pattern=/^[\!"%&'()\*\+,\-\./0-9:;<=>\?A-Z_a-z]{1,20}$/;if(!pattern.test(lot)){alert("Invalid characters found in lot code. Only upper and lower case characters A-Z, digits 0-9, the symbols !, \", %, &, ', (, ), *, +, -, ., /, :, ;, <, =, >, ? and _ as well as a comma are allowed.");return true}return false}function InvalidDate(date){if(date.length==0){return false}if((date.length!=6)||!NumericOnly(date)){alert("Please enter a date in the format YYMMDD.");return true}var yy=2000+eval(date.substring(0,2));var mm=date.substring(2,4)-1;var dd=date.substring(4,6);var dateObject=new Date(yy,mm,dd);if(eval(date.substring(0,2))!=(dateObject.getYear()%100)||(dateObject.getMonth()!=mm)||(dateObject.getDate()!=dd)){alert("An invalid date was given. Please try again using the format YYMMDD.");return true}}function CreateCrc16(){var polynomial,value,temp;var table=new Array(256);polynomial=40961;for(i=0;i<table.length;++i){value=0;temp=i;for(j=0;j<8;++j){if(0!=((value^temp)&1)){value=(value>>1)^polynomial}else{value>>=1}temp>>=1}table[i]=value}return table}this.ResetGeneratedVoiceCode=function(){document.getElementById("vc_generatedCode").style.visibility="hidden";SetElementText(document.getElementById("vc_minorCode"),"00");SetElementText(document.getElementById("vc_majorCode"),"00")};function SetElementText(element,value){var supportsInnerText=(document.getElementsByTagName("body")[0].innerText!=undefined)?true:false;if(supportsInnerText){element.innerText=value}else{element.textContent=value}}this.DisplayVoiceCode=function(){var crc,table,testString,index;var gtinElement=document.getElementById("vc_gtin").value;var lotElement=document.getElementById("vc_lot").value;var dateElement=document.getElementById("vc_packDate").value;if(InvalidGtin(gtinElement)){return}if(InvalidLot(lotElement)){return}if(InvalidDate(dateElement)){return}crc=0;table=CreateCrc16();testString=gtinElement+lotElement+dateElement;for(i=0;i<testString.length;++i){index=(crc^testString.charCodeAt(i))%256;crc=(crc>>8)^table[index]}var vc=(crc%10000)+"";var length=vc.length;for(i=vc.length;i<4;i++){vc="0"+vc}SetElementText(document.getElementById("vc_minorCode"),vc.substr(0,2));SetElementText(document.getElementById("vc_majorCode"),vc.substr(2,2));document.getElementById("vc_generatedCode").style.visibility="visible"}};ymxss.init();